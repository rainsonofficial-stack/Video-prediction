<!DOCTYPE html>
<html>
<head>
    <title>Private Illusionist</title>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Playfair+Display:ital@0;1&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { 
            margin: 0; padding: 0; 
            background: #000000; color: #d4af37; 
            font-family: 'Playfair Display', serif;
            display: flex; flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        .header-stack { position: relative; width: 100%; line-height: 0; }
        .base-img { width: 100%; height: auto; display: block; opacity: 0.8; }

        .header-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.2); 
            display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
            text-align: center; line-height: normal;
            padding-top: 500px; 
            box-sizing: border-box;
        }

        h1 { font-family: 'Cinzel', serif; font-size: 2.8rem; margin: 0; letter-spacing: 4px; color: #fff; text-shadow: 0 2px 15px rgba(0,0,0,1); }
        
        .tier-container { margin-top: 30px; display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; }
        .tier-chip {
            padding: 10px 20px;
            border: 1px solid #444;
            background: rgba(255,255,255,0.05);
            color: #888;
            font-family: 'Cinzel', serif;
            font-size: 0.8rem;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .tier-chip span { display: block; font-family: 'Playfair Display', serif; font-size: 0.7rem; margin-top: 4px; opacity: 0.7; }
        .tier-chip.selected { border-width: 1px; color: #fff; background: rgba(255,255,255,0.1); transform: translateY(-2px); }
        .silver-tier.selected { border-color: #c0c0c0; box-shadow: 0 0 10px rgba(192,192,192,0.3); color: #c0c0c0; }
        .gold-tier.selected { border-color: #d4af37; box-shadow: 0 0 10px rgba(212,175,55,0.3); color: #d4af37; }
        .diamond-tier.selected { border-color: #e0e0e0; box-shadow: 0 0 15px rgba(255,255,255,0.4); color: #fff; }

        .enquire-btn { display: inline-block; padding: 15px 45px; border: 1px solid #d4af37; color: #d4af37; text-decoration: none; font-size: 1.2rem; letter-spacing: 3px; margin-top: 25px; background: rgba(0,0,0,0.4); font-weight: bold; transition: 0.3s; }
        .enquire-btn:hover { background: #d4af37; color: #000; }

        .content { width: 100%; display: flex; flex-direction: column; align-items: center; padding: 260px 0 0 0; }
        .pitch { width: 88%; max-width: 800px; text-align: center; color: #d4af37; font-size: 1.5rem; line-height: 1.8; margin-bottom: 50px; letter-spacing: 1.5px; font-weight: 400; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .symbols { font-size: 3rem; letter-spacing: 20px; margin-bottom: 25px; }
        .red { color: #ff3b3b; } 
        .black { color: #ffffff; }

        .video-container { 
            position: relative; 
            width: 85%; 
            max-width: 720px; 
            aspect-ratio: 16/9;
            background: #000; 
            box-shadow: 0 20px 50px rgba(0,0,0,1); 
            border: 1px solid #222;
            overflow: hidden;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        video {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            object-fit: contain;
            transition: none; 
            pointer-events: none;
            opacity: 0;
        }

        .video-visible { opacity: 1 !important; z-index: 2; }
        .video-hidden { opacity: 0 !important; z-index: 1; }

        #buffer-overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); 
            display: none; 
            align-items: center; justify-content: center;
            z-index: 100;
            pointer-events: none;
        }
        .spinner {
            width: 45px; height: 45px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            border-top-color: #ffffff;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .ui-overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            pointer-events: none; transition: opacity 0.3s; opacity: 1; z-index: 110; 
            background: rgba(0, 0, 0, 0.3); 
        }
        .ui-hidden { opacity: 0 !important; }
        
        #playBtn { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            background: rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.5); 
            color: white; width: 120px; height: 120px; border-radius: 50%; 
            font-size: 40px; pointer-events: none;
        }
        
        #progress-bar { 
            position: absolute; bottom: 15px; left: 5%; width: 90%; 
            accent-color: #ffffff; pointer-events: auto;
            z-index: 120;
        }

        #v-timer {
            position: absolute; bottom: 42px; right: 5%;
            color: #ffffff; font-family: 'Roboto', sans-serif; font-size: 1.6rem;
            z-index: 150; pointer-events: none; text-shadow: 0 0 5px rgba(0,0,0,1);
        }

        .footer { width: 100%; padding: 60px 0 80px 0; text-align: center; color: #555; font-weight: bold; font-size: 1rem; letter-spacing: 5px; text-transform: uppercase; }
        #discreet-dot { opacity: 0; transition: opacity 0.2s; }
    </style>
</head>
<body>

    <div class="header-stack">
        <img src="illusion.jpg" class="base-img" alt="Background">
        <div class="header-overlay">
            <h1>Private Illusionist</h1>
            <div class="tier-container">
                <div class="tier-chip silver-tier" onclick="selectTier('Silver', this)">SILVER<span>₹50,000+ / $2,000+</span></div>
                <div class="tier-chip gold-tier selected" id="defaultTier" onclick="selectTier('Gold', this)">GOLD<span>₹1,00,000+ / $5,000+</span></div>
                <div class="tier-chip diamond-tier" onclick="selectTier('Diamond', this)">DIAMOND<span>₹5,00,000+ / $10,000+</span></div>
            </div>
            <a href="mailto:management@rainsonofficial.com?subject=Magic Enquiry Gold" id="enqBtn" class="enquire-btn">Request an Appearance</a>
        </div>
    </div>

    <div class="content">
        <div class="pitch">"What is possible" is subjective. The Fifth Dimension is reserved for private audiences and closed rooms.</div>
        <div class="symbols">
            <span class="black">♠</span> <span class="red">♥</span> <span class="black">♣</span> <span class="red">♦</span>
        </div>
        <div class="video-container" id="v-cont">
            <video id="playerA" class="video-visible" playsinline muted crossOrigin="anonymous" preload="auto"></video>
            <video id="playerB" class="video-hidden" playsinline muted crossOrigin="anonymous" preload="auto"></video>
            <div id="v-timer">0:00</div>
            <div id="buffer-overlay"><div class="spinner"></div></div>
            <div class="ui-overlay" id="uiOverlay">
                <button id="playBtn">&#9654;</button>
                <input type="range" id="progress-bar" min="0" max="100" value="0">
            </div>
        </div>
    </div>

    <div class="footer">♤ rainsonofficial.com<span id="discreet-dot">.</span></div>

    <script>
        function selectTier(tierName, element) {
            document.querySelectorAll('.tier-chip').forEach(chip => chip.classList.remove('selected'));
            element.classList.add('selected');
            document.getElementById('enqBtn').href = `mailto:management@rainsonofficial.com?subject=Magic Enquiry ${tierName}`;
        }

        const firebaseConfig = {
            apiKey: "AIzaSyDxPQYrMlOslsqJeHnfj2MSpROZfaAwVH0",
            authDomain: "rainson-magic.firebaseapp.com",
            projectId: "rainson-magic",
            databaseURL: "https://rainson-magic-default-rtdb.firebaseio.com",
            storageBucket: "rainson-magic.firebasestorage.app",
            messagingSenderId: "290150598500",
            appId: "1:290150598500:web:4fbe7642b2baf839609c71"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const videoMap = {
            // Spades (1-10)
            '1': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769448416/2s_uqen8g.mp4',
            '2': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769448414/3s_xsu5ss.mp4',
            '3': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769448414/4s_pgind5.mp4',
            '4': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769448413/5s_wrw6um.mp4',
            '5': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769448415/6s_l3fnt2.mp4',
            '6': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769448411/7s_bt0ejd.mp4',
            '7': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769448411/8h_urhvtg.mp4',
            '8': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769448428/9s_ns6m0b.mp4',
            '9': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769448411/10s_tl2om9.mp4',
            '10': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769448414/As_gpn9r9.mp4',

            // Hearts (11-20)
            '11': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769499785/2h_kmlgqn.mp4',
            '12': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769499948/3h_rla2fp.mp4',
            '13': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769499937/4h_bx2rvn.mp4',
            '14': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769499892/5h_t9vio1.mp4',
            '15': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769499901/6h_aahyaf.mp4',
            '16': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769499925/7h_pbevxb.mp4',
            '17': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769499921/8h_fvmtdr.mp4',
            '18': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769499939/9h_zsb49m.mp4',
            '19': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769499925/10h_npdx6y.mp4',
            '20': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769499790/Ah_rvyui5.mp4',

            // Clubs (21-30)
            '21': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769494438/2c_jw9lsf.mp4',
            '22': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769494438/3c_fucu3c.mp4',
            '23': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769494438/4c_sjeacs.mp4',
            '24': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769494437/5c_o1x7bh.mp4',
            '25': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769494441/6c_po6e4y.mp4',
            '26': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769494441/7c_brfdzi.mp4',
            '27': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769494445/8c_x6mgha.mp4',
            '28': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769448428/9s_ns6m0b.mp4',
            '29': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769494445/10c_ljuoh1.mp4',
            '30': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769494435/Ac_gzuxlv.mp4',

            // Diamonds (31-40)
            '31': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769503504/2d_goxhyk.mp4',
            '32': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769503502/3d_n8ngg4.mp4',
            '33': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769503500/4d_uqfppe.mp4',
            '34': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769503491/5d_olbzjv.mp4',
            '35': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769503493/6d_hdiitl.mp4',
            '36': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769503496/7d_ft1r4x.mp4',
            '37': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769503495/8d_us6w8x.mp4',
            '38': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769503491/9d_bi67k3.mp4',
            '39': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769503494/10d_dwbghm.mp4',
            '40': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769503502/Ad_xwkb1m.mp4'
        };

        let active = document.getElementById('playerA');
        let hidden = document.getElementById('playerB');
        let currentID = null; 
        let lastSentTime = 0;
        let isStale = false;
        let hideTimeout;
        let dotTimeout;

        const bgMusic = new Audio('backgroundmagic.mp3');
        bgMusic.loop = true;

        const EXPIRE_AFTER = 15 * 60 * 1000;
        function checkTime() { const timeDiff = Date.now() - lastSentTime; isStale = (timeDiff >= EXPIRE_AFTER); }
        db.ref('lastSentTime').on('value', snap => { lastSentTime = snap.val() || 0; checkTime(); });

        function handleVideoEnd() {
            active.pause();
            bgMusic.pause();
            active.currentTime = 0;
            bgMusic.currentTime = 0;
            cancelFadeTimer();
        }

        // Monitoring for Pipeline Stalls (S24 Fix)
        const monitorStalls = (vid) => {
            vid.addEventListener('waiting', () => { if(!vid.paused) setBuffering(true); });
            vid.addEventListener('playing', () => setBuffering(false));
            vid.onended = handleVideoEnd;
        };
        monitorStalls(active);
        monitorStalls(hidden);

        function handleSourceSync(val) {
            if (!val || val === currentID) return;
            
            const newSrc = videoMap[val];
            const wasPlaying = !active.paused;
            const currentTime = active.currentTime;

            if (currentID === null) {
                currentID = val;
                active.src = newSrc;
                active.load();
                // Fix 1: Initial Load now waits for data to avoid freeze
                active.onloadeddata = () => {
                    setBuffering(false);
                    active.onloadeddata = null;
                };
            } else {
                currentID = val;
                hidden.src = newSrc;
                hidden.currentTime = currentTime;
                hidden.load();
                hidden.onloadeddata = () => {
                    hidden.currentTime = active.currentTime;
                    if (wasPlaying) {
                        hidden.play().then(() => performCut()).catch(() => performCut());
                    } else {
                        performCut();
                    }
                    hidden.onloadeddata = null;
                };
            }
        }

        function performCut() {
            hidden.classList.replace('video-hidden', 'video-visible');
            setTimeout(() => {
                active.classList.replace('video-visible', 'video-hidden');
                active.pause();
                let oldActive = active;
                active = hidden;
                hidden = oldActive;
            }, 50);

            const dot = document.getElementById('discreet-dot');
            dot.style.opacity = "1";
            clearTimeout(dotTimeout);
            dotTimeout = setTimeout(() => { dot.style.opacity = "0"; }, 15000);
        }

        db.ref('currentVideo').on('value', snap => handleSourceSync(snap.val()));

        function setBuffering(bool) {
            const overlay = document.getElementById('buffer-overlay');
            if (bool) { 
                overlay.style.display = 'flex'; 
                document.getElementById('uiOverlay').classList.add('ui-hidden'); 
            } else { 
                overlay.style.display = 'none'; 
            }
        }
        
        function togglePlay() { 
            if (active.paused) { 
                active.play().catch(() => {}); 
                bgMusic.play().catch(() => {}); 
                startFadeTimer(); 
            } else { 
                active.pause(); 
                bgMusic.pause(); 
                cancelFadeTimer(); 
            } 
        }

        function startFadeTimer() { clearTimeout(hideTimeout); hideTimeout = setTimeout(() => { if (!active.paused) { document.getElementById('uiOverlay').classList.add('ui-hidden'); document.getElementById('v-cont').style.cursor = 'none'; } }, 1000); }
        function cancelFadeTimer() { clearTimeout(hideTimeout); document.getElementById('uiOverlay').classList.remove('ui-hidden'); document.getElementById('v-cont').style.cursor = 'default'; }
        document.getElementById('v-cont').addEventListener('click', (e) => { if (e.target.id === 'progress-bar') return; if (document.getElementById('buffer-overlay').style.display === 'flex') return; togglePlay(); });
        
        setInterval(() => {
            document.getElementById('playBtn').innerHTML = active.paused ? "&#9654;" : "||";
            if (!active.paused && active.duration) {
                document.getElementById('progress-bar').value = (active.currentTime / active.duration) * 100;
                const mins = Math.floor(active.currentTime / 60);
                const secs = Math.floor(active.currentTime % 60);
                document.getElementById('v-timer').innerText = `${mins}:${secs < 10 ? '0' : ''}${secs}`;

                if (isStale && active.currentTime >= 10) { 
                    active.currentTime = 10; 
                    active.pause(); 
                    bgMusic.pause(); 
                    setBuffering(true); 
                }
            }
        }, 50);

        document.getElementById('progress-bar').oninput = (e) => {
            const targetTime = (e.target.value / 100) * active.duration;
            if (isStale && targetTime >= 10) { 
                active.currentTime = 10; 
                bgMusic.currentTime = 10; 
                setBuffering(true); 
                return; 
            }
            active.currentTime = targetTime;
            bgMusic.currentTime = targetTime; 
            const mins = Math.floor(active.currentTime / 60);
            const secs = Math.floor(active.currentTime % 60);
            document.getElementById('v-timer').innerText = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            cancelFadeTimer();
        };

        document.addEventListener('contextmenu', event => event.preventDefault());
        document.onkeydown = function(e) {
            if(e.keyCode == 123) return false;
            if(e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) return false;
            if(e.ctrlKey && e.shiftKey && e.keyCode == 'J'.charCodeAt(0)) return false;
            if(e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) return false;
        };
    </script>
</body>
</html>

