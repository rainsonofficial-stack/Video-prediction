<!DOCTYPE html>
<html>
<head>
    <title>Luxury Illusionist</title>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Playfair+Display:ital@0;1&display=swap" rel="stylesheet">
    <style>
        body { 
            margin: 0; padding: 0; 
            background: #0a0a0a; color: #d4af37; 
            font-family: 'Playfair Display', serif;
            display: flex; flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        .header-stack { position: relative; width: 100%; line-height: 0; }
        .base-img { width: 100%; height: auto; display: block; }

        .header-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6); 
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center; line-height: normal;
            padding-top: 50px; 
            box-sizing: border-box;
        }

        h1 { font-family: 'Cinzel', serif; font-size: 2.8rem; margin: 0; letter-spacing: 4px; color: #fff; text-shadow: 0 2px 15px rgba(0,0,0,1); }
        .enquire-btn { display: inline-block; padding: 15px 45px; border: 1px solid #d4af37; color: #d4af37; text-decoration: none; font-size: 1.2rem; letter-spacing: 3px; margin-top: 20px; background: rgba(0,0,0,0.4); font-weight: bold; }

        .content { width: 100%; display: flex; flex-direction: column; align-items: center; padding: 40px 0 0 0; }

        .pitch { 
            width: 85%; max-width: 700px;
            text-align: center; color: #d4af37;
            font-size: 1.1rem; line-height: 1.6;
            margin-bottom: 30px; letter-spacing: 1px;
            font-weight: 300;
        }

        .intro-text { font-style: italic; color: #888; font-size: 1.8rem; margin-bottom: 10px; }
        .symbols { font-size: 2.5rem; letter-spacing: 15px; margin-bottom: 15px; }
        .red { color: #ff3b3b; } 
        .black { color: #ffffff; }

        .video-container { 
            position: relative; 
            width: 76%; 
            max-width: 680px; 
            background: #000; 
            box-shadow: 0 10px 30px rgba(0,0,0,1); 
            border: 1px solid #1a1a1a; 
        }
        canvas { width: 100%; display: block; cursor: pointer; }
        
        #buffer-overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); 
            backdrop-filter: blur(2px);
            display: none; 
            align-items: center; justify-content: center;
            z-index: 100;
        }
        .spinner {
            width: 50px; height: 50px;
            border: 3px solid rgba(212, 175, 55, 0.2);
            border-radius: 50%;
            border-top-color: #d4af37;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .ui-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; transition: opacity 0.5s; opacity: 1; }
        .ui-hidden { opacity: 0; }
        #playBtn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.7); border: 1px solid #fff; color: white; width: 65px; height: 65px; border-radius: 50%; font-size: 24px; cursor: pointer; pointer-events: auto; z-index: 20; }
        #progress-bar { position: absolute; bottom: 15px; left: 5%; width: 90%; accent-color: #fff; pointer-events: auto; }

        .footer { 
            width: 100%; padding: 25px 0 50px 0; text-align: center; color: #999; 
            font-weight: bold; font-size: 0.9rem; letter-spacing: 4px; 
            text-transform: uppercase; text-shadow: 0 0 5px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>

    <div class="header-stack">
        <img src="illusion.jpg" class="base-img" alt="Background">
        <div class="header-overlay">
            <h1>Luxury Illusionist</h1>
            <a href="mailto:management@rainsonofficial.com" class="enquire-btn">ENQUIRE NOW</a>
        </div>
    </div>

    <div class="content">
        <div class="pitch">
            Reality is more flexible than it appears. The Fifth Dimension explores that idea through a discreet, high-level illusion experience, created for private audiences and closed rooms.
        </div>

        <div class="intro-text">I made a video for you....</div>
        <div class="symbols">
            <span class="black">♠</span> <span class="red">♥</span> <span class="black">♣</span> <span class="red">♦</span>
        </div>
        <div class="video-container">
            <canvas id="magicCanvas" width="1280" height="720"></canvas>
            <div id="buffer-overlay"><div class="spinner"></div></div>
            <div class="ui-overlay" id="uiOverlay">
                <button id="playBtn" onclick="togglePlay(event)">&#9654;</button>
                <input type="range" id="progress-bar" min="0" max="100" value="0">
            </div>
        </div>
    </div>

    <div class="footer" id="footerText">♤rainsonofficial</div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDxPQYrMlOslsqJeHnfj2MSpROZfaAwVH0",
            authDomain: "rainson-magic.firebaseapp.com",
            projectId: "rainson-magic",
            databaseURL: "https://rainson-magic-default-rtdb.firebaseio.com",
            storageBucket: "rainson-magic.firebasestorage.app",
            messagingSenderId: "290150598500",
            appId: "1:290150598500:web:4fbe7642b2baf839609c71"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const canvas = document.getElementById('magicCanvas');
        const ctx = canvas.getContext('2d');
        const progressBar = document.getElementById('progress-bar');
        const bufferOverlay = document.getElementById('buffer-overlay');
        
        const videoMap = {
            'video1': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769255934/lv_0_20260124172742_nqtx0o.mp4',
            'video2': 'https://res.cloudinary.com/de76iytbx/video/upload/v1769255963/lv_0_20260124172757_wdysqo.mp4'
        };

        // AUDIO FIX: Two players, only one is ever unmuted
        let playerA = document.createElement('video');
        let playerB = document.createElement('video');
        [playerA, playerB].forEach(v => {
            v.loop = true; v.muted = true; v.playsInline = true; v.crossOrigin = "anonymous";
        });

        let activePlayer = playerA;
        let hiddenPlayer = playerB;
        let currentID = 'video1';
        let lastSentTime = 0;
        let isLocked = false;

        const EXPIRE_AFTER = 5 * 60 * 1000;
        const STOP_VIDEO_AT = 10;

        activePlayer.src = videoMap[currentID];
        activePlayer.muted = false; // Start first player unmuted

        db.ref('lastSentTime').on('value', snap => { lastSentTime = snap.val() || 0; });

        progressBar.addEventListener('input', function() {
            if(isLocked) return;
            activePlayer.currentTime = (progressBar.value / 100) * activePlayer.duration;
        });

        db.ref('currentVideo').on('value', (snapshot) => {
            const val = snapshot.val() || 'video1';
            if (val !== currentID) {
                isLocked = false;
                bufferOverlay.style.display = 'none';
                
                const syncTime = activePlayer.currentTime;
                const isPlaying = !activePlayer.paused;
                currentID = val;

                // Prepare hidden player (silently)
                hiddenPlayer.src = videoMap[val];
                hiddenPlayer.muted = true; 
                hiddenPlayer.load();
                hiddenPlayer.currentTime = syncTime;

                hiddenPlayer.oncanplaythrough = () => {
                    if (isPlaying) {
                        hiddenPlayer.play().then(() => {
                            // SWAP
                            let temp = activePlayer;
                            activePlayer = hiddenPlayer;
                            hiddenPlayer = temp;

                            // AUDIO CLEANUP
                            hiddenPlayer.pause();
                            hiddenPlayer.muted = true;
                            activePlayer.muted = false; 
                        });
                    } else {
                        let temp = activePlayer;
                        activePlayer = hiddenPlayer;
                        hiddenPlayer = temp;
                        activePlayer.muted = false;
                        hiddenPlayer.muted = true;
                        hiddenPlayer.pause();
                    }
                    hiddenPlayer.oncanplaythrough = null;
                };
            }
        });

        function togglePlay(e) { 
            e.stopPropagation(); 
            if (isLocked) return;
            if (activePlayer.paused) { 
                activePlayer.muted = false;
                activePlayer.play(); 
                document.getElementById('playBtn').innerHTML = "||"; 
                showUI(); 
            } else { 
                activePlayer.pause(); 
                document.getElementById('playBtn').innerHTML = "&#9654;"; 
            } 
        }
        
        let hideTimeout;
        function showUI() { 
            uiOverlay.classList.remove('ui-hidden'); 
            clearTimeout(hideTimeout); 
            if (!activePlayer.paused) { hideTimeout = setTimeout(() => { uiOverlay.classList.add('ui-hidden'); }, 2000); }
        }

        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); showUI(); });

        function render() {
            ctx.drawImage(activePlayer, 0, 0, canvas.width, canvas.height);

            const timeSinceInput = Date.now() - lastSentTime;
            if (timeSinceInput > EXPIRE_AFTER && activePlayer.currentTime >= STOP_VIDEO_AT) {
                isLocked = true;
                activePlayer.pause();
                activePlayer.muted = true; // Silence on lock
                activePlayer.currentTime = STOP_VIDEO_AT;
                bufferOverlay.style.display = 'flex';
                document.getElementById('playBtn').innerHTML = "&#9654;";
            }

            if (!activePlayer.paused && activePlayer.duration) { 
                progressBar.value = (activePlayer.currentTime / activePlayer.duration) * 100; 
            }
            requestAnimationFrame(render);
        }
        render();
    </script>
</body>
</html>
